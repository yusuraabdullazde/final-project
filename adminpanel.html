<!Doctype HTML>
<html>

<head>
    <title></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="./assets/css/css/adminpanel.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>


<body>

    <div id="mySidenav" class="sidenav">
        <div class="images">
            <img src="./assets/image/logo_Asset-1-1.png" alt="">
        </div>
        <a href="#" class="icon-a"><i class="fa fa-dashboard icons"></i> Dashboard</a>
        <a href="#" class="icon-a"><i class="fa fa-users icons"></i> Customers</a>
        <a href="#" class="icon-a"><i class="fa fa-list icons"></i> Projects</a>
        <a href="#" class="icon-a"><i class="fa fa-user icons"></i> Accounts</a>

    </div>
    <div id="main">

        <div class="head">
            <div class="col-div-6">
                <span style="font-size:30px;cursor:pointer; color: white;" class="nav">☰ Dashboard</span>
                <span style="font-size:30px;cursor:pointer; color: white;" class="nav2">☰ Dashboard</span>
            </div>

            <div class="col-div-6">
                <div class="profile">
                    <img src="./assets/image/download.png" class="pro-img" />
                    <p></p>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="clearfix"></div>
        <br />

        <div class="col-div-3">
            <div class="box">
                <p class="count">0 <br /><span>Customers</span></p>
                <i class="fa fa-users box-icon"></i>
            </div>
        </div>
        <div class="col-div-3">
            <div class="box">
                <p class="coutn2">1<br /><span>Projects</span></p>
                <i class="fa fa-list box-icon"></i>
            </div>
        </div>
        <div class="clearfix"></div>
        <br /><br />
        <div class="col-div-12">
            <div class="box-8">
                <div class="content-box">
                    <p>ALL ACCOUNTS <span>Sell All</span></p>
                    <br />
                    <table>
                        <tr>
                            <th>ID:</th>
                            <th>First Name:</th>
                            <th>Last Name:</th>
                            <th>Email:</th>
                            <th>Cancel:</th>
                            <th>Add:</th>
                            <th>
                                Edit:
                                Delete:
                            </th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(".nav").click(function () {
            $("#mySidenav").css('width', '70px');
            $("#main").css('margin-left', '70px');
            $(".logo").css('visibility', 'hidden');
            $(".logo span").css('visibility', 'visible');
            $(".logo span").css('margin-left', '-10px');
            $(".icon-a").css('visibility', 'hidden');
            $(".icons").css('visibility', 'visible');
            $(".icons").css('margin-left', '-8px');
            $(".nav").css('display', 'none');
            $(".nav2").css('display', 'block');
        });

        $(".nav2").click(function () {
            $("#mySidenav").css('width', '300px');
            $("#main").css('margin-left', '300px');
            $(".logo").css('visibility', 'visible');
            $(".icon-a").css('visibility', 'visible');
            $(".icons").css('visibility', 'visible');
            $(".nav").css('display', 'block');
            $(".nav2").css('display', 'none');
        });
        const firstname = document.querySelector(".firstname")
        const lastname = document.querySelector(".lastname")
        const email = document.querySelector(".email")
        const message = document.querySelector(".message")
        const table = document.querySelector("table")
        const profile = document.querySelector(".profile p")

        let say = 0;
        fetch("http://localhost:3000/myaccount")

            .then(res => res.json())
            .then(data => {
                say++
                profile.innerText = data[0].first_name
                count.innerHTML = `${data[0].type.pending.length}<br><span>Customers</span>`
                console.log(data[0].type.pending);
                y = data[0].type.pending
                data[0].type.pending.forEach(element => {
                    table.innerHTML += `
        <tr>
        <td>${say++}</td>
        <td >${element.first_name}</td>
        <td >${element.last_name}</td>
        <td class='salam salam${say}'> ${element.email}</td>
        <td>
            <button onclick="cancel(${say})">Cancel</button>
        </td>
        <td>
            <button onclick="add(${say})">Add</button>
        </td>
        <td>
            <i class="bi bi-pencil-fill" onclick="updatefunc(${say})"></i>
            <i class="bi bi-trash3-fill" onclick="deletefunk(${say})"></i>
        </td>
    </tr>`
                })


            })
        function deletefunk(id) {
            const salam = document.querySelector(`.salam${id}`)
            console.log(salam);
            axios.get(`http://localhost:3000/myaccount/`)
                .then(res => res.data)
                .then(data => {
                    // x = .forEach(data => {
                    // salam.forEach(s => {
                        const id = data[0].type.pending.find((f) => f.email == salam.innerText)
                        if (id) {
                            console.log(id);
                            console.log("dfsdfg");
                            boyuktype=data[0].type.accepted
                            index = data[0].type.pending.indexOf(id)
                            console.log(index);
                            if(index!=0){
                                teze1=data[0].type.pending.slice(0,index)
                                teze2= data[0].type.pending.slice(index+1)
                                teze= teze1.concat(teze2)
                                console.log(teze, data[0].type.pending.slice(0,index));

                                
                            }else{
                               teze=data[0].type.pending.slice(index) 
                            }
                            axios.patch(`http://localhost:3000/myaccount/`+ data[0].id, {type :{
                                    pending:teze,
                                    accepted:boyuktype
                                }})
                                window.location.reload()
                        }
                    })
        }


        function updatefunc(id) {
            event.preventDefault()
            const modal = document.createElement("div")
            modal.classList.add("modal")
            modal.innerHTML = `
           <div class="form">
               <div class="form-content">
                  <label for="name1">First-Name:</label>
                  <input type="text" class="firstname" value="new first-name" required> 
                  <label for="name1">Last-Name:</label>
                  <input type="text" class="lastname" required>
                  <label for="name1">Email:</label>
                  <input type="text" class="email" required>
                  <button class="save">SAVE</button>
                  <button class="closebtn">CLOSE</button>
               </div>
           </div>
    `

            document.body.appendChild(modal)
            const close = document.querySelector(".closebtn")
            close.addEventListener("click", () => {
                modal.remove()
            })

            const fileInput = document.querySelector('input[type="file"]');
            const firstnameInput = document.querySelector('.firstname');
            const lastnameInput = document.querySelector('.lastname');
            const emailInput = document.querySelector(".email")
            let save = document.querySelector(".save");

            axios.get(`http://localhost:3000/pending/${id}`)
                .then(data => {
                    firstnameInput.value = data.first_name;
                    lastnameInput.value = data.last_name;
                    emailInput.value = data.email;
                });

            save.addEventListener("click", () => {
                axios.put(`http://localhost:3000/pending/${id}`, {
                    first_name: firstnameInput.value,
                    last_name: lastnameInput.value,
                    email: emailInput.value
                })
                    .then(response => {
                        window.location = "../final-project/adminpanel.html";
                    })
                    .catch(error => {
                        console.error("Error updating data:", error);
                    });
            });
        }

        const count = document.querySelector(".count")
        // document.write(localStorage.setItem("first_name"))

    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


</body>


</html>