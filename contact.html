<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="./assets/css/style.css">
  <style>
    a {
      text-decoration: none;
      color: white;
    }
  </style>

</head>

<body>
  <section id="appointment">
    <div class="container">
      <div class="appointment">
        <div class="appointment-img">
          <img src="./assets/image/portrait-of-young-multiracial-doctor-sitting-at-re-XGVTY4V.jpg" alt="">
        </div>
        <div class="appointment-text">
          <h4>APPOINTMENT</h4>
          <h2>Book Your Appointment</h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut elit tellus, luctus nec ullamcorper
            mattis. </p>
          <div class="form">
            <form class="row g-3 needs-validation" novalidate class="form" onsubmit="sendEmail(event)">
              <input type="hidden" name="access_key" value="46ca0ff7-c2e6-404d-b1a8-d23c03b8f64b">
              <div class="col-md-6">
                <label for="validationCustom01" class="form-label">First name</label>
                <input type="text" class="form-control firstname" id="validationCustom01" name="firstname" required>
                <div class="valid-feedback">
                  Looks good!
                </div>
                <div class="invalid-feedback">
                  Please choose a first name.
                </div>
              </div>
              <div class="col-md-6">
                <label for="validationCustom02" class="form-label">Username</label>
                <input type="text" class="form-control lastname" id="validationCustom02" name="lastname" required>
                <div class="valid-feedback">
                  Looks good!
                </div>
                <div class="invalid-feedback">
                  Please choose a last name.
                </div>
              </div>
              <div class="col-md-6">
                <label for="validationCustomUsername" class="form-label">Email</label>
                <div class="input-group has-validation">
                  <span class="input-group-text" id="inputGroupPrepend">@</span>
                  <input type="text" class="form-control email" id="validationCustomUsername"
                    aria-describedby="inputGroupPrepend" name="email" required>
                  <div class="valid-feedback">
                    Looks good!
                  </div>
                  <div class="invalid-feedback">
                    Please choose a email.
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <label for="validationCustom03" class="form-label">Message</label>
                <textarea class="form-control message" id="validationCustom03 " name="message" required></textarea>
                <div class="valid-feedback">
                  Looks good!
                </div>
                <div class="invalid-feedback">
                  Please provide a valid password.
                </div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary submit" type="submit">Submit form</button>
                <button class="btn btn-primary close" type="submit"><a href="./index.html">Close form</a></button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script src="https://smtpjs.com/v3/smtp.js">
  </script>
  <script>

    function sendEmail(e) {
      e.preventDefault()
      let ebody = `
     <b>Fist_name:</b>${firstname.value}<br>
     <b>Last_name:</b>${lastname.value}<br>
     <b>Email:</b>${email.value}<br>
     <b>Message:</b>${message.value}<br>
    <a href="http://C:/Users/yusur/OneDrive/Desktop/final-project/okey.html" class="okey" onclick="okey()">OK</a>
    <a href="no.html" class="no" onclick="no()">NO</a>
     `

      Email.send({
        Host: "smtp.elasticemail.com",
        Username: "yusurea@gmail.com",
        Password: "1979B701E4C119E706B4C45598821E5E5754",
        To: 'yusurea@gmail.com',
        From: document.querySelector(".email").value,
        Subject: document.querySelector(".lastname").value,
        Body: ebody
      }).then(
        message => alert(message)
      );
      return alert("Email Sendedd")
    }

    const ok = document.querySelector(".okey")
    const no = document.querySelector(".no")
    function okey() {
      console.log("salam");
      ok.addEventListener("click", () => {
        let arr = pending[pending.length - 1]
        axios.delete(`http://localhost:3000/pending/${arr}`)
        window.location.reload();
        axios.post("http://localhost:3000/accepted")
          .then(res => console.log(res.data))
      })
    }


    (() => {
      'use strict'
      const forms = document.querySelectorAll('.needs-validation')
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }

          form.classList.add('was-validated')
        }, false)
      })
    })()


    const form = document.querySelector("form")
    const firstname = document.querySelector(".firstname")
    const lastname = document.querySelector(".lastname")
    const email = document.querySelector(".email")
    const message = document.querySelector(".message")
    const submit = document.getElementsByClassName("form-contact")[0]

    form.addEventListener("submit", (event) => {
      event.preventDefault();

      let obj = {
        first_name: firstname.value,
        last_name: lastname.value,
        email: email.value,
        message: message.value
      }
      axios.post("http://localhost:3000/pending", obj)
        .then(res => console.log(res.data))

    })
  </script>
</body>

</html>